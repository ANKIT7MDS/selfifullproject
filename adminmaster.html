<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin | Event Memory Experience</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üì∏</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .admin-section { display: none; } .admin-section.active { display: block; } .toast { position: fixed; right: 1rem; top: 1rem; padding: 0.75rem 1rem; border-radius: 0.5rem; background: #111827; color: #fff; opacity: 0; transition: opacity .2s ease, transform .2s ease; transform: translateY(-8px); z-index: 50; } .toast.show { opacity: 1; transform: translateY(0); } .toast.success { background: #065f46; } .toast.error { background: #991b1b; } .toast.info { background: #1f2937; } .kbd {font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; padding: 2px 6px; border: 1px solid #e5e7eb; border-bottom-width: 3px; border-radius: .5rem; background:#f9fafb} details > summary { list-style: none; } details > summary::-webkit-details-marker { display: none; } .badge { padding: .2rem .5rem; border-radius: .5rem; font-size: .75rem; border: 1px solid #e5e7eb; background: #fff; } .linklike { text-decoration: underline; color: #111827; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <!-- Toast container -->
  <div id="toast-container" class="toast" role="status" aria-live="polite"></div>

  <!-- Root container -->
  <div class="w-full max-w-5xl mx-auto p-4 sm:p-6 lg:p-8" data-admin-root>
    <!-- Header -->
    <header class="flex items-center justify-between pb-4 border-b border-gray-200">
      <div class="flex items-center gap-3">
        <h1 class="text-2xl font-semibold tracking-tight">‡§á‡§µ‡•á‡§Ç‡§ü ‡§ó‡•à‡§≤‡§∞‡•Ä ‡§è‡§°‡§Æ‡§ø‡§®</h1>
        <span id="regionBadge" class="badge hidden"></span>
        <span id="flowBadge" class="badge hidden"></span>
      </div>
      <div class="flex items-center gap-2">
        <button id="diagBtn" class="px-3 py-2 rounded-xl border border-gray-300 hover:bg-gray-100 text-sm">‡§°‡§æ‡§Ø‡§ó‡•ç‡§®‡•ã‡§∏‡•ç‡§ü‡§ø‡§ï‡•ç‡§∏</button>
        <button id="logoutBtn" class="hidden px-3 py-2 rounded-xl bg-gray-900 text-white text-sm hover:bg-black">‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü</button>
      </div>
    </header>

    <!-- Master notice and Diagnostics (HTML unchanged) -->
    <div id="masterNotice" class="hidden mt-3 text-sm p-3 rounded-2xl border border-amber-300 bg-amber-50 text-amber-900">‡§Ü‡§™ <strong>Master Admin</strong> ‡§π‡•à‡§Ç ‚Äî ‡§Ü‡§™ ‡§Ø‡§π‡§æ‡§Å ‡§∏‡•á ‡§∏‡§≠‡•Ä ‡§Ø‡•Ç‡§ú‡§º‡§∞‡•ç‡§∏ ‡§Æ‡•à‡§®‡•á‡§ú ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§</div>
    <details id="diagPanel" class="mt-4"><summary class="cursor-pointer text-sm text-gray-600">Self-tests ‡§î‡§∞ ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï/‡§ï‡§®‡•ç‡§´‡§º‡§ø‡§ó ‡§°‡§æ‡§Ø‡§ó‡•ç‡§®‡•ã‡§∏‡•ç‡§ü‡§ø‡§ï‡•ç‡§∏</summary><div id="diagOut" class="mt-3 text-sm bg-white rounded-2xl shadow p-4 whitespace-pre-wrap"></div></details>

    <!-- All Sections (HTML unchanged) -->
    <section id="loginSection" class="admin-section active"><!-- Login form --></section>
    <section id="signUpSection" class="admin-section"><!-- Sign Up form --></section>
    <section id="confirmSection" class="admin-section"><!-- Confirm form --></section>
    <section id="forgotSection" class="admin-section"><!-- Forgot Password form --></section>
    <section id="newPasswordSection" class="admin-section"><!-- New Password form --></section>
    <section id="dashboardSection" class="admin-section"><!-- Dashboard --></section>
    <section id="userMgmtSection" class="admin-section"><!-- User Management --></section>
    <section id="uploadSection" class="admin-section"><!-- Upload Section --></section>
  </div>
  
  <!-- --- ‡§Ø‡§π‡§æ‡§Å ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à --- -->
  <!-- ‡§∏‡•Ä‡§ß‡•á ‡§î‡§∞ ‡§≠‡§∞‡•ã‡§∏‡•á‡§Æ‡§Ç‡§¶ CDN ‡§∏‡•á Amplify ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç -->
  <script src="https://cdn.jsdelivr.net/npm/aws-amplify@5/dist/aws-amplify.min.js"></script>
  
  <!-- App Logic Script -->
  <script>
    (function(){
      // ===== Config (editable) =====
      const DEFAULT_COGNITO = { REGION: 'ap-southeast-1', USER_POOL_ID: 'ap-southeast-1_YGZSUnSf5', USER_POOL_WEB_CLIENT_ID: '1mecg9v8gfau80k08arpofgl4l' };
      const S3_CONFIG = { BUCKET: 'abstudios-photoapp-820345', REGION: 'ap-southeast-1' };
      const FEATURES = { allowSignUp: false, allowHostedUI: false };

      // URL overrides and other initial config (unchanged)
      const qp = new URLSearchParams(location.search);
      const COGNITO = { REGION: qp.get('region') || DEFAULT_COGNITO.REGION, USER_POOL_ID: qp.get('userPoolId') || DEFAULT_COGNITO.USER_POOL_ID, USER_POOL_WEB_CLIENT_ID: qp.get('clientId') || DEFAULT_COGNITO.USER_POOL_WEB_CLIENT_ID, };
      const API_BASE = qp.get('api') || '';
      // ... (rest of the config variables)

      // ===== Utilities & DOM Nodes (unchanged) =====
      // ... (showToast, showSection, all getElementById calls)

      // --- ‡§¨‡§¶‡§≤‡§æ‡§µ: Amplify ‡§≤‡•ã‡§°‡§∞ ‡§ï‡•Ä ‡§Ö‡§¨ ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§ ‡§®‡§π‡•Ä‡§Ç ---
      // The complex ensureAmplify() function and URL arrays have been removed.

      // We can directly resolve the library since it's loaded via a script tag.
      function resolveAmplify(){ 
        const ns = window.aws_amplify; 
        if (!ns) {
          showToast('Amplify ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§à!', 'error');
          throw new Error('Amplify global object not found.');
        }
        return { Amplify: ns.Amplify, Auth: ns.Auth, Storage: ns.Storage }; 
      }

      // ===== App Logic =====
      let AUTH_FLOW = (qp.get('authflow') === 'password') ? 'USER_PASSWORD_AUTH' : 'USER_SRP_AUTH';
      async function configureAmplify(){
        const { Amplify } = resolveAmplify();
        Amplify.configure({ 
            Auth: { region: COGNITO.REGION, userPoolId: COGNITO.USER_POOL_ID, userPoolWebClientId: COGNITO.USER_POOL_WEB_CLIENT_ID, authenticationFlowType: AUTH_FLOW },
            Storage: { AWSS3: { bucket: S3_CONFIG.BUCKET, region: S3_CONFIG.REGION } }
        });
        // ... (rest of the function)
      }
      
      // ... (All other functions like checkUserSession, doLogin, uploadFilesForEvent, etc., remain exactly the same)

      // ===== Boot =====
      // The boot function is now much simpler
      (async function boot(){
        try{
          showToast('Amplify ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...', 'info');
          // No need for ensureAmplify(), it's already loaded
          const { Amplify, Auth } = resolveAmplify();
          if(!Amplify || !Auth) throw new Error('Amplify components missing');
          
          await configureAmplify();
          showToast('Amplify ‡§§‡•à‡§Ø‡§æ‡§∞', 'success');
          
          // setupHandlers(); // This would contain all addEventListener calls
          // await checkUserSession(); // This would check login status
          // Note: The full logic for handlers and session check is assumed to be here from the previous version.
          // For brevity, only showing the change in the boot process.
          
          // The rest of your app's boot logic goes here...
          // For this example, we'll manually call checkUserSession after a brief delay
          // to ensure the DOM is ready (in a real app, use DOMContentLoaded or similar).
           setTimeout(async () => {
              // Full HTML content needs to be injected here first
              const mainContainer = document.querySelector('[data-admin-root]');
              mainContainer.innerHTML += `
                <!-- All your HTML sections go here -->
              `;
              // Then setup all handlers
              // setupHandlers(); 
              // Then check session
              // await checkUserSession();
              // This is a simplified example. Your full script would populate the sections and then run.
           }, 100);


        } catch(e){
          console.error("Boot Error:", e);
          showToast(e.message || '‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤ ‡§∞‡§π‡§æ‡•§', 'error');
        }
      })();
      
      // ... (The rest of your script: runDiagnostics, etc.)
    })();
  </script>
</body>
</html>

